-- 테이블 삭제
DROP TABLE RESPONSE CASCADE CONSTRAINTS;
DROP TABLE EX_MAP CASCADE CONSTRAINTS;
DROP TABLE EXHIBITION_LIKE CASCADE CONSTRAINTS;
DROP TABLE EXHIBITION CASCADE CONSTRAINTS;
DROP TABLE CHILDREN_REPLY CASCADE CONSTRAINTS;
DROP TABLE PARENT_REPLY CASCADE CONSTRAINTS;
DROP TABLE INQUIRY CASCADE CONSTRAINTS;
DROP TABLE COMMUNITY CASCADE CONSTRAINTS;
DROP TABLE COMMUNITY_REPORT CASCADE CONSTRAINTS;
DROP TABLE REVIEW CASCADE CONSTRAINTS;
DROP TABLE PAYMENT CASCADE CONSTRAINTS;
DROP TABLE TICKETING CASCADE CONSTRAINTS;
DROP TABLE EXHIBITION_DETAIL CASCADE CONSTRAINTS;  
DROP TABLE USER_INFO CASCADE CONSTRAINTS;

-- 기존 시퀀스 삭제
DROP SEQUENCE SEQ_USER_NO;
DROP SEQUENCE SEQ_EXHIBITION_NO;
DROP SEQUENCE SEQ_MERCHANT_UID;
DROP SEQUENCE SEQ_PAYMENT_NO;
DROP SEQUENCE SEQ_POST_NO;
DROP SEQUENCE SEQ_INQUIRY_NO;
DROP SEQUENCE SEQ_PARENT_REPLY_NO;
DROP SEQUENCE SEQ_CHILDREN_REPLY_NO;
DROP SEQUENCE SEQ_NAVER_USER_NO;
DROP SEQUENCE SEQ_GOOGLE_USER_NO;

-- 새 시퀀스 생성
CREATE SEQUENCE SEQ_USER_NO;
CREATE SEQUENCE SEQ_EXHIBITION_NO;
CREATE SEQUENCE SEQ_MERCHANT_UID;
CREATE SEQUENCE SEQ_PAYMENT_NO;
CREATE SEQUENCE SEQ_POST_NO;
CREATE SEQUENCE SEQ_INQUIRY_NO;
CREATE SEQUENCE SEQ_PARENT_REPLY_NO;
CREATE SEQUENCE SEQ_CHILDREN_REPLY_NO;
CREATE SEQUENCE SEQ_NAVER_USER_NO;
CREATE SEQUENCE SEQ_GOOGLE_USER_NO;

-- 테이블 생성
CREATE TABLE USER_INFO (
	USER_NO	NUMBER		NOT NULL,
	NAME		VARCHAR2(30)	NOT NULL,
	USER_ID	VARCHAR2(50)		NULL,
	USER_PW	VARCHAR2(100)		NULL,
	EMAIL	VARCHAR2(40)		NOT NULL UNIQUE,
	PHONE	VARCHAR2(11)		NULL UNIQUE,
	ADDRESS	VARCHAR2(200)		NULL,
	ADDRESS_DETAIL VARCHAR2(200) NULL,
	CREATE_DATE	DATE	DEFAULT SYSDATE	NOT NULL,
	UPDATE_DATE	DATE		NULL,
	USER_STATUS	CHAR(1)	DEFAULT 'N'	NOT NULL CHECK (USER_STATUS IN ('N', 'Y')),
	METHOD	VARCHAR2(10)		NOT NULL CHECK (METHOD IN ('NORMAL', 'NAVER', 'GOOGLE')),
	SOCIAL_USER_IDENTIFIER VARCHAR2(50) 	NULL,
	GRADE	CHAR(1)	DEFAULT 'U'	NOT NULL CHECK (GRADE IN ('U', 'A'))
);

CREATE TABLE EXHIBITION_DETAIL (
	EXHIBITION_NO	NUMBER		NOT NULL,
	USE_FEE	VARCHAR2(600)		NULL,
	STRT_DATE	VARCHAR2(100)		NOT NULL,
	END_DATE	VARCHAR2(100)		NOT NULL,
	DETAIL_IMG_URL	VARCHAR2(2000)		NULL,
	ORG_LINK	VARCHAR2(2000)		NOT NULL
);

CREATE TABLE TICKETING (
	MERCHANT_UID	VARCHAR2(50)	NOT NULL,
	TICKETING_DATE	DATE	DEFAULT SYSDATE	NOT NULL,
	VISIT_DATE	DATE		NULL,
	TICKET_STATUS	CHAR(6)	DEFAULT '예매'	NOT NULL,
	TICKET_COUNT	NUMBER		NOT NULL,
	EXHIBITION_NO	NUMBER		NOT NULL,
	USER_NO	NUMBER			NOT NULL,
	NAME	VARCHAR2(200)		NOT NULL,
	BUYER_NAME VARCHAR2(30)	NOT NULL,
	BUYER_TEL VARCHAR2(11)		NOT NULL
);

CREATE TABLE PAYMENT (
	MERCHANT_UID	VARCHAR2(50)		NOT NULL,
	PAY_METHOD	VARCHAR2(50)		NULL,
	STATUS	VARCHAR2(30)		NOT NULL,
	IMP_UID	VARCHAR2(50)		NOT NULL,
	PAID_AMOUNT	NUMBER		NOT NULL
);

CREATE TABLE REVIEW (
	MERCHANT_UID	VARCHAR2(50)		NOT NULL,
	USER_NO	NUMBER		NOT NULL,
        EXHIBITION_TITLE VARCHAR2(300) NOT NULL,
	REVIEW_TITLE	VARCHAR2(150)		NOT NULL,
	REVIEW_CONTENT	VARCHAR2(1500)		NOT NULL,
	REVIEW_DATE	DATE	DEFAULT SYSDATE	NOT NULL,
	REVIEW_STATUS	CHAR(1)	DEFAULT 'N'	NOT NULL
);

CREATE TABLE COMMUNITY (
	POST_NO	NUMBER		NOT NULL,
	POST_TITLE	VARCHAR2(150)		NOT NULL,
	POST_CONTENT	VARCHAR2(4000)		NOT NULL,
	POST_CATEGORY	 VARCHAR2(12)		NOT NULL,
	POST_DATETIME	DATE		NOT NULL,
	POST_VIEW_COUNT	NUMBER	DEFAULT 0	NOT NULL,
	POST_STATUS	CHAR(1)	DEFAULT 'N'	NOT NULL CHECK (POST_STATUS IN ('N', 'Y')),
	USER_NO	NUMBER		NOT NULL
);

CREATE TABLE COMMUNITY_REPORT  (
   USER_NO   NUMBER      NOT NULL,
   POST_NO   NUMBER      NOT NULL
);

CREATE TABLE INQUIRY (
	INQUIRY_NO	NUMBER		NOT NULL,
	USER_NO	NUMBER		NOT NULL,
	INQUIRY_TITLE	VARCHAR2(150)		NOT NULL,
	INQUIRY_CONTENT	VARCHAR2(4000)		NOT NULL,
	INQUIRY_DATE	DATE	DEFAULT SYSDATE	NOT NULL,
	INQUIRY_RESPONSE	CHAR(1)	DEFAULT 'N'	NOT NULL CHECK (INQUIRY_RESPONSE IN ('N', 'Y')),
	RESPONSE_CONTENT	VARCHAR2(4000)		NULL
);

CREATE TABLE PARENT_REPLY (
	PARENT_REPLY_NO	NUMBER		NOT NULL,
	PARENT_REPLY_CONTENT	VARCHAR2(1500)		NOT NULL,
	PARENT_REPLY_DATETIME	DATE		NULL,
	PARENT_REPLY_STATUS	CHAR(1)	DEFAULT 'N'	NOT NULL CHECK (PARENT_REPLY_STATUS IN ('N', 'Y')),
	USER_NO	NUMBER		NOT NULL,
	POST_NO	NUMBER		NOT NULL
);

CREATE TABLE CHILDREN_REPLY (
	CHILDREN_REPLY_NO	NUMBER		NOT NULL,
	CHILDREN_REPLY_CONTENT	VARCHAR2(1500)		NOT NULL,
	CHILDREN_REPLY_DATETIME	DATE	DEFAULT SYSDATE	NOT NULL,
	CHILDREN_REPLY_STATUS	CHAR(1)	DEFAULT 'N'	NOT NULL CHECK (CHILDREN_REPLY_STATUS IN ('N', 'Y')),
	PARENT_REPLY_NO	NUMBER		NOT NULL,
	USER_NO	NUMBER		NOT NULL
);

CREATE TABLE EXHIBITION_LIKE (
	USER_NO	NUMBER		NOT NULL,
	EXHIBITION_NO	NUMBER		NOT NULL
);

CREATE TABLE EXHIBITION (
    EXHIBITION_NO NUMBER NOT NULL,
    TITLE VARCHAR2(300) NOT NULL,
    PLACE VARCHAR2(300) NOT NULL,
    MAIN_IMG VARCHAR2(500) NULL,
    EX_DATE VARCHAR2(50) NOT NULL,
    CODENAME VARCHAR2(20) NOT NULL,
    IS_FREE VARCHAR2(6) NOT NULL CHECK (IS_FREE IN ('유료', '무료')),
    STATUS CHAR(1) DEFAULT 'N' NOT NULL CHECK (STATUS IN ('Y', 'N'))
);

CREATE TABLE EX_MAP (
	EXHIBITION_NO	NUMBER		NOT NULL,
	GUNAME	VARCHAR2(50)		NULL,
	LOT	VARCHAR2(20)		NOT NULL,
	LAT	VARCHAR2(20)		NOT NULL
);

CREATE TABLE RESPONSE (
	INQUIRY_NO	NUMBER		NOT NULL,
	RESPONSE_CONTENT	VARCHAR2(4000)		NOT NULL,
	USER_NO	NUMBER		NOT NULL
);

-- 제약 조건 추가
ALTER TABLE USER_INFO ADD CONSTRAINT PK_USER_INFO PRIMARY KEY (USER_NO);
ALTER TABLE EXHIBITION_DETAIL ADD CONSTRAINT PK_EXHIBITION_DETAIL PRIMARY KEY (EXHIBITION_NO);
ALTER TABLE TICKETING ADD CONSTRAINT PK_TICKETING PRIMARY KEY (MERCHANT_UID);
ALTER TABLE PAYMENT ADD CONSTRAINT PK_PAYMENT PRIMARY KEY (MERCHANT_UID);
ALTER TABLE REVIEW ADD CONSTRAINT PK_REVIEW PRIMARY KEY (MERCHANT_UID, USER_NO);
ALTER TABLE COMMUNITY ADD CONSTRAINT PK_COMMUNITY PRIMARY KEY (POST_NO);
ALTER TABLE COMMUNITY_REPORT ADD CONSTRAINT PK_COMMUNITY_REPORT PRIMARY KEY (USER_NO, POST_NO);
ALTER TABLE INQUIRY ADD CONSTRAINT PK_INQUIRY PRIMARY KEY (INQUIRY_NO);
ALTER TABLE PARENT_REPLY ADD CONSTRAINT PK_PARENT_REPLY PRIMARY KEY (PARENT_REPLY_NO);
ALTER TABLE CHILDREN_REPLY ADD CONSTRAINT PK_CHILDREN_REPLY PRIMARY KEY (CHILDREN_REPLY_NO);
ALTER TABLE EXHIBITION_LIKE ADD CONSTRAINT PK_EXHIBITION_LIKE PRIMARY KEY (USER_NO, EXHIBITION_NO);
ALTER TABLE EXHIBITION ADD CONSTRAINT PK_EXHIBITION PRIMARY KEY (EXHIBITION_NO);
ALTER TABLE EX_MAP ADD CONSTRAINT PK_EX_MAP PRIMARY KEY (EXHIBITION_NO);
ALTER TABLE RESPONSE ADD CONSTRAINT PK_RESPONSE PRIMARY KEY (INQUIRY_NO);

-- 외래 키 추가
ALTER TABLE EXHIBITION_DETAIL ADD CONSTRAINT FK_EXHIBITION_TO_EXHIBITION_DETAIL_1 FOREIGN KEY (EXHIBITION_NO) REFERENCES EXHIBITION (EXHIBITION_NO) ON DELETE CASCADE;
ALTER TABLE TICKETING ADD CONSTRAINT FK_EXHIBITION_TO_TICKETING_1 FOREIGN KEY (EXHIBITION_NO) REFERENCES EXHIBITION (EXHIBITION_NO)  ON DELETE CASCADE;
ALTER TABLE TICKETING ADD CONSTRAINT FK_USER_INFO_TO_TICKETING_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO);
ALTER TABLE PAYMENT ADD CONSTRAINT FK_TICKETING_TO_PAYMENT_1 FOREIGN KEY (MERCHANT_UID) REFERENCES TICKETING (MERCHANT_UID);
ALTER TABLE REVIEW ADD CONSTRAINT FK_TICKETING_TO_REVIEW_1 FOREIGN KEY (MERCHANT_UID) REFERENCES TICKETING (MERCHANT_UID);
ALTER TABLE REVIEW ADD CONSTRAINT FK_USER_INFO_TO_REVIEW_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO);
ALTER TABLE COMMUNITY ADD CONSTRAINT FK_USER_INFO_TO_COMMUNITY_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO);
ALTER TABLE INQUIRY ADD CONSTRAINT FK_USER_INFO_TO_INQUIRY_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO);
ALTER TABLE PARENT_REPLY ADD CONSTRAINT FK_USER_INFO_TO_PARENT_REPLY_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO);
ALTER TABLE PARENT_REPLY ADD CONSTRAINT FK_COMMUNITY_TO_PARENT_REPLY_1 FOREIGN KEY (POST_NO) REFERENCES COMMUNITY (POST_NO);
ALTER TABLE CHILDREN_REPLY ADD CONSTRAINT FK_PARENT_REPLY_TO_CHILDREN_REPLY_1 FOREIGN KEY (PARENT_REPLY_NO) REFERENCES PARENT_REPLY (PARENT_REPLY_NO);
ALTER TABLE CHILDREN_REPLY ADD CONSTRAINT FK_USER_INFO_TO_CHILDREN_REPLY_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO);
ALTER TABLE EXHIBITION_LIKE ADD CONSTRAINT FK_USER_INFO_TO_EXHIBITION_LIKE_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO) ON DELETE CASCADE;
ALTER TABLE EXHIBITION_LIKE ADD CONSTRAINT FK_EXHIBITION_TO_EXHIBITION_LIKE_1 FOREIGN KEY (EXHIBITION_NO) REFERENCES EXHIBITION (EXHIBITION_NO) ON DELETE CASCADE;
ALTER TABLE EX_MAP ADD CONSTRAINT FK_EXHIBITION_TO_EX_MAP_1 FOREIGN KEY (EXHIBITION_NO) REFERENCES EXHIBITION (EXHIBITION_NO) ON DELETE CASCADE;
ALTER TABLE RESPONSE ADD CONSTRAINT FK_INQUIRY_TO_RESPONSE_1 FOREIGN KEY (INQUIRY_NO) REFERENCES INQUIRY (INQUIRY_NO);
ALTER TABLE RESPONSE ADD CONSTRAINT FK_USER_INFO_TO_RESPONSE_1 FOREIGN KEY (USER_NO) REFERENCES USER_INFO (USER_NO);

-- 주석 추가
COMMENT ON COLUMN USER_INFO.USER_NO IS 'SEQ_USER_NO';
COMMENT ON COLUMN USER_INFO.USER_ID IS '회원 아이디/소셜 로그인의 경우 NULL 허용';
COMMENT ON COLUMN USER_INFO.USER_PW IS '회원 비밀번호/소셜 로그인의 경우 NULL 허용';
COMMENT ON COLUMN USER_INFO.EMAIL IS '회원 이메일';
COMMENT ON COLUMN USER_INFO.PHONE IS '회원 연락처/본인인증 수단에 따라 13자로 변경 가능성 있음';
COMMENT ON COLUMN USER_INFO.ADDRESS IS '회원 주소';
COMMENT ON COLUMN USER_INFO.CREATE_DATE IS '회원 가입일';
COMMENT ON COLUMN USER_INFO.UPDATE_DATE IS '회원 탈퇴일';
COMMENT ON COLUMN USER_INFO.USER_STATUS IS '회원 탈퇴 여부/CHECK(''N'', ''Y'')/N: 가입, Y: 탈퇴';
COMMENT ON COLUMN USER_INFO.METHOD IS '회원 가입 방법/CHECK(''NORMAL'', ''NAVER'', ''GOOGLE'')';
COMMENT ON COLUMN USER_INFO.GRADE IS '회원 등급/CHECK(''U'', ''A'')/U: 일반회원, A: 관리자';
COMMENT ON COLUMN EXHIBITION_DETAIL.EXHIBITION_NO IS 'SEQ_EXHIBITION_NO';
COMMENT ON COLUMN EXHIBITION_DETAIL.USE_FEE IS '무료일 경우 NULL일 수 있음';
COMMENT ON COLUMN EXHIBITION_DETAIL.STRT_DATE IS '시작일';
COMMENT ON COLUMN EXHIBITION_DETAIL.END_DATE IS '종료일';
COMMENT ON COLUMN EXHIBITION_DETAIL.DETAIL_IMG_URL IS '상세이미지';
COMMENT ON COLUMN TICKETING.MERCHANT_UID IS '예매 번호/T2024유저번호전시번호SUFFIX';
COMMENT ON COLUMN TICKETING.TICKETING_DATE IS '예매일';
COMMENT ON COLUMN TICKETING.VISIT_DATE IS '관람일/상시 상품의 경우 NULL';
COMMENT ON COLUMN TICKETING.TICKET_STATUS IS '예매 상태/예매/취소';
COMMENT ON COLUMN TICKETING.EXHIBITION_NO IS '전시고유번호/SEQ_EXHIBITION_NO';
COMMENT ON COLUMN TICKETING.USER_NO IS '유저고유번호/SEQ_USER_NO';
COMMENT ON COLUMN PAYMENT.PAY_METHOD IS '신용카드/무통장입금';
COMMENT ON COLUMN PAYMENT.STATUS IS '완료/취소';
COMMENT ON COLUMN PAYMENT.MERCHANT_UID IS '예매번호';
COMMENT ON COLUMN REVIEW.MERCHANT_UID IS '예매번호';
COMMENT ON COLUMN REVIEW.USER_NO IS '유저고유번호/SEQ_USER_NO';
COMMENT ON COLUMN REVIEW.REVIEW_TITLE IS '리뷰제목';
COMMENT ON COLUMN REVIEW.REVIEW_CONTENT IS '리뷰내용';
COMMENT ON COLUMN REVIEW.REVIEW_DATE IS '리뷰작성일';
COMMENT ON COLUMN REVIEW.REVIEW_STATUS IS '리뷰삭제여부/CHECK(''N'', ''Y'')/N: 등록, Y: 삭제';
COMMENT ON COLUMN COMMUNITY.POST_NO IS '게시글번호/SEQ_POST_NO';
COMMENT ON COLUMN COMMUNITY.POST_TITLE IS '게시글제목';
COMMENT ON COLUMN COMMUNITY.POST_CONTENT IS '게시글내용';
COMMENT ON COLUMN COMMUNITY.POST_CATEGORY IS '카테고리/(정보공유/기대평/동행구인/잡담)';
COMMENT ON COLUMN COMMUNITY.POST_DATETIME IS '게시글작성일';
COMMENT ON COLUMN COMMUNITY.POST_VIEW_COUNT IS '게시글조회수';
COMMENT ON COLUMN COMMUNITY.POST_STATUS IS '게시글삭제여부/CHECK(''N'', ''Y'')/N: 등록, Y: 삭제';
COMMENT ON COLUMN COMMUNITY.USER_NO IS '유저고유번호/SEQ_USER_NO';
COMMENT ON COLUMN INQUIRY.INQUIRY_NO IS '문의고유번호/SEQ_INQUIRY_NO';
COMMENT ON COLUMN INQUIRY.USER_NO IS '유저고유번호/SEQ_USER_NO';
COMMENT ON COLUMN INQUIRY.INQUIRY_TITLE IS '문의제목';
COMMENT ON COLUMN INQUIRY.INQUIRY_CONTENT IS '문의내용';
COMMENT ON COLUMN INQUIRY.INQUIRY_DATE IS '문의작성일';
COMMENT ON COLUMN INQUIRY.INQUIRY_RESPONSE IS '답변여부/CHECK(''N'',''Y'') N: 답변 대기, Y: 답변 완료';
COMMENT ON COLUMN INQUIRY.RESPONSE_CONTENT IS '답변내용';
COMMENT ON COLUMN PARENT_REPLY.PARENT_REPLY_NO IS '댓글번호/SEQ_REPLY';
COMMENT ON COLUMN PARENT_REPLY.PARENT_REPLY_CONTENT IS '댓글내용';
COMMENT ON COLUMN PARENT_REPLY.PARENT_REPLY_DATETIME IS '작성일';
COMMENT ON COLUMN PARENT_REPLY.PARENT_REPLY_STATUS IS '댓글삭제여부/CHECK(''N'', ''Y'')/N: 등록, Y: 삭제';
COMMENT ON COLUMN PARENT_REPLY.USER_NO IS '유저고유번호/SEQ_USER_NO';
COMMENT ON COLUMN PARENT_REPLY.POST_NO IS '게시글번호/SEQ_POST_NO';
COMMENT ON COLUMN CHILDREN_REPLY.CHILDREN_REPLY_NO IS '답글번호/SEQ_CHILDREN_REPLY';
COMMENT ON COLUMN CHILDREN_REPLY.CHILDREN_REPLY_CONTENT IS '답글내용';
COMMENT ON COLUMN CHILDREN_REPLY.CHILDREN_REPLY_DATETIME IS '답글작성일';
COMMENT ON COLUMN CHILDREN_REPLY.CHILDREN_REPLY_STATUS IS '답글삭제여부/CHECK(''N'', ''Y'')/N: 등록, Y: 삭제';
COMMENT ON COLUMN CHILDREN_REPLY.PARENT_REPLY_NO IS '댓글번호/SEQ_REPLY';
COMMENT ON COLUMN CHILDREN_REPLY.USER_NO IS '유저고유번호/SEQ_USER_NO';
COMMENT ON COLUMN EXHIBITION_LIKE.USER_NO IS '유저고유번호/SEQ_USER_NO';
COMMENT ON COLUMN EXHIBITION_LIKE.EXHIBITION_NO IS '전시고유번호/SEQ_EXHIBITION_NO';
COMMENT ON COLUMN EXHIBITION.EXHIBITION_NO IS '전시고유번호/SEQ_EXHIBITION_NO';
COMMENT ON COLUMN EXHIBITION.TITLE IS '전시명';
COMMENT ON COLUMN EXHIBITION.PLACE IS '장소';
COMMENT ON COLUMN EXHIBITION.MAIN_IMG IS '대표이미지';
COMMENT ON COLUMN EXHIBITION.EX_DATE IS '기간';
COMMENT ON COLUMN EXHIBITION.CODENAME IS '분류';
COMMENT ON COLUMN EXHIBITION.IS_FREE IS '유무료/CHECK(''유료'', ''무료'')';
COMMENT ON COLUMN EX_MAP.EXHIBITION_NO IS '전시고유번호/SEQ_EXHIBITION_NO';
COMMENT ON COLUMN EX_MAP.GUNAME IS '자치구명';
COMMENT ON COLUMN EX_MAP.LOT IS '위도';
COMMENT ON COLUMN EX_MAP.LAT IS '경도';
COMMENT ON COLUMN RESPONSE.INQUIRY_NO IS 'SEQ_INQUIRY_NO';
COMMENT ON COLUMN RESPONSE.USER_NO IS 'SEQ_USER_NO';
